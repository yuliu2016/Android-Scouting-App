package ca.warp7.android.scouting

import android.annotation.SuppressLint
import android.content.Context
import android.os.Build
import android.text.Html
import android.text.Spanned
import android.view.View
import androidx.appcompat.app.AppCompatDelegate
import ca.warp7.android.scouting.entry.Board
import ca.warp7.android.scouting.entry.RelativeBoard
import ca.warp7.android.scouting.ui.EntryInMatch

fun View.show() {
    visibility = View.VISIBLE
}

fun View.hide() {
    visibility = View.GONE
}


private fun getRaw(context: Context, id: Int): String {
    val resources = context.resources
    return try {
        resources.openRawResource(id).bufferedReader().readText()
    } catch (e: Exception) {
        e.printStackTrace()
        ""
    }
}

@Suppress("DEPRECATION")
fun getHTMLFromContext(context: Context, id: Int): Spanned {
    return Html.fromHtml(getRaw(context, id))
}

const val kTimerLimit = 150
const val kAutonomousTime = 15
const val kFadeDuration = 100
const val kTotalTimerDigits = 3

const val kScoutIntent = "intent.scout"
const val kEntryInMatchIntent = "intent.entry"

fun validateName(str: String): Boolean {
    val name = str.trim()
    if (name.isEmpty()) return false
    val split = name.split(" ")
    return split.size >= 2 && split[0][0].isUpperCase() &&
            split.subList(1, split.size).all { it.length == 1 && it[0].isUpperCase() }
}

val boards = Board.values()
val relBoards = RelativeBoard.values()

/**
 * Change template strings (e.g. "B1 blocks shots")
 * into the actual team name/number of the specific match
 */
@SuppressLint("DefaultLocale")
fun modifyNameForDisplay(eim: EntryInMatch?, name: String): String {
    var varName = name
    if (eim != null && eim.teams.size > 5) {
        for (i in 0 until 6) {
            varName = varName.replace(boards[i].name, eim.teams[i].toString())
        }
        for (i in 0 until 6) {
            val relBoard = relBoards[i]
            val team = eim.teams[relBoard.relativeTo(eim.board).ordinal].toString()
            varName = varName.replace(relBoard.name, team)
        }
    }
    return varName.split("_".toRegex()).joinToString(" ") { it.capitalize() }
}

fun setDarkTheme(darkTheme: String?) {
    val newState = when (darkTheme) {
        "Light" -> AppCompatDelegate.MODE_NIGHT_NO
        "Dark" -> AppCompatDelegate.MODE_NIGHT_YES
        else -> if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q) {
            AppCompatDelegate.MODE_NIGHT_FOLLOW_SYSTEM
        } else {
            AppCompatDelegate.MODE_NIGHT_AUTO_BATTERY
        }
    }
    AppCompatDelegate.setDefaultNightMode(newState)
}